<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.4.5" />
<title></title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

@media print {
  div#footer-badges { display: none; }
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 2px solid silver;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
</head>
<body>
<div id="header">
</div>
<div class="paragraph"><p>Spring Integration Tutorial</p></div>
<div class="exampleblock">
<div class="exampleblock-content">
</div></div>
<h2 id="_what_is_spring_integration">What is Spring Integration?</h2>
<div class="sectionbody">
<div class="paragraph"><p>Spring Integration is an extension to the Spring Framework that adds support for Enterprise Integration Patterns (<a href="https://www.youtube.com/watch?v=Xwi1DU6KoQ4">https://www.youtube.com/watch?v=Xwi1DU6KoQ4</a>).
It essentially adds support for messaging within an application and integration with external systems. Here I will highlight both using a business use case of a Cafe.</p></div>
<div class="paragraph"><p>In case you are curious, here is the finished product: <a href="https://cafe-tmehta.rhcloud.com/cafe-web">https://cafe-tmehta.rhcloud.com/cafe-web</a> and <a href="https://cafe-tmehta.rhcloud.com/cafe-processing">https://cafe-tmehta.rhcloud.com/cafe-processing</a></p></div>
<div class="paragraph"><div class="title">Domain:</div><p>Here is a quick overview of the domain use case:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>                                                                                         Barista
                                                                     hotDrinks       ____________________
                                                                    |==========| --&gt;|                    |
                     orders                   drinks               /                | prepareHotDrink()  |      preparedDrinks
Place Order -&gt;Cafe-&gt;|======|-&gt;OrderSplitter-&gt;|======|-&gt;DrinkRouter                  |                    |--&gt;|==========|
                                                                   \ coldDrinks     | prepareColdDrink() |
                                                                    |==========| --&gt;|                    |
                                                                                    |____________________|

                                                    Legend: |====| - channels
                                                            -&gt;*-&gt; - Message Endpoints (Filters)</tt></pre>
</div></div>
<div class="paragraph"><p>Based on the use case, we have the following domain level classes:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Cafe - Takes in orders
</p>
</li>
<li>
<p>
Order - Consists a list of OrderItems
</p>
</li>
<li>
<p>
OrderItems - Type of order, how many cups/shots, etc.
</p>
</li>
<li>
<p>
Drink - Individual Drinks
</p>
</li>
</ol></div>
<div class="paragraph"><p>From the business model perspective: The role of the user ends once they have placed an order and the Cafe and its staff takes over after that.
Therefore, the business use case is split into two applications, one a Web Interface that uses a Spring MVC form to place orders and the other a order processing module. This division of labour follows good programming practices and also helps illustrate Spring Integrations prowess in allowing integration with external systems.
Both these applications will use the domain objects so without further ado here is code snippet for the domain objects:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>@Entity
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Order</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Serializable <span style="color: #FF0000">{</span>

        <span style="color: #990000">...</span>

        @<span style="font-weight: bold"><span style="color: #000000">OneToMany</span></span><span style="color: #990000">(</span>cascade<span style="color: #990000">=</span>CascadeType<span style="color: #990000">.</span>ALL<span style="color: #990000">,</span> fetch<span style="color: #990000">=</span>FetchType<span style="color: #990000">.</span>EAGER<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #008080">List&lt;OrderItem&gt;</span> orderItems <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> ArrayList<span style="color: #990000">&lt;</span>OrderItem<span style="color: #990000">&gt;();</span>

        @Id
        @GeneratedValue
        <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> id<span style="color: #990000">;</span>

        <span style="color: #990000">...</span>

<span style="color: #FF0000">}</span>

@Entity
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">OrderItem</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> Serializable <span style="color: #FF0000">{</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #008080">DrinkType</span> type<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> shots <span style="color: #990000">=</span> <span style="color: #993399">1</span><span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">boolean</span> iced <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #0000FF">false</span></span><span style="color: #990000">;</span>

    @Id
    @GeneratedValue
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> id<span style="color: #990000">;</span>

    <span style="font-style: italic"><span style="color: #9A1900">/** the order this item is tied to */</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> orderNumber<span style="color: #990000">;</span>

        <span style="color: #990000">...</span>

<span style="color: #FF0000">}</span>


<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">enum</span> DrinkType <span style="color: #FF0000">{</span>

        ESPRESSO<span style="color: #990000">,</span>
        LATTE<span style="color: #990000">,</span>
        CAPPUCCINO<span style="color: #990000">,</span>
        MOCHA

<span style="color: #FF0000">}</span>

@Entity
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Drink</span> <span style="color: #FF0000">{</span>

        @Id
        @GeneratedValue
        <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> id<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">boolean</span> iced<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> shots<span style="color: #990000">;</span>

    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #008080">DrinkType</span> drinkType<span style="color: #990000">;</span>

        <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> orderNumber<span style="color: #990000">;</span>

        <span style="color: #990000">...</span>

<span style="color: #FF0000">}</span>


@Entity
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Delivery</span> <span style="color: #FF0000">{</span>

        @<span style="font-weight: bold"><span style="color: #000000">OneToMany</span></span><span style="color: #990000">(</span>cascade<span style="color: #990000">=</span>CascadeType<span style="color: #990000">.</span>ALL<span style="color: #990000">,</span> fetch<span style="color: #990000">=</span>FetchType<span style="color: #990000">.</span>EAGER<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #008080">List&lt;Drink&gt;</span> deliveredDrinks<span style="color: #990000">;</span>

    @Id
    @GeneratedValue
    <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> id<span style="color: #990000">;</span>

        <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #009900">int</span> orderNumber<span style="color: #990000">;</span>

        <span style="color: #990000">...</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The classes are annotated with @Entity as to allow persistence and Order and OrderItem implement Serializable to allow transmission across applications.</p></div>
<div class="paragraph"><p>First I will show how to design the web and processing modules as separate applications and then later show how to configure them to</p></div>
<div class="paragraph"><div class="title">Web Module:</div><p>The web module is responsible for the <strong>Place Order &#8594;&#8230;</strong> part of the use case. The web module is written using Spring MVC (a good tutorial on Spring MVC: &lt;link/&gt;). It consists of a Order form and an Order Item form. In addition to Spring MVC, the form also uses a bit of Javascript to increase the interactivety of the application.
Here is the relevant bits of code:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>@Controller
@<span style="font-weight: bold"><span style="color: #000000">RequestMapping</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"/order"</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">OrderController</span> <span style="color: #FF0000">{</span>
        <span style="color: #990000">...</span>

        @<span style="font-weight: bold"><span style="color: #000000">RequestMapping</span></span><span style="color: #990000">(</span>method <span style="color: #990000">=</span> RequestMethod<span style="color: #990000">.</span>POST<span style="color: #990000">)</span>
        @<span style="font-weight: bold"><span style="color: #000000">ResponseStatus</span></span><span style="color: #990000">(</span>HttpStatus<span style="color: #990000">.</span>CREATED<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> @ResponseBody <span style="color: #008080">String</span> <span style="font-weight: bold"><span style="color: #000000">orderCreate</span></span><span style="color: #990000">(</span><span style="color: #008080">Order</span> order<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">throws</span></span> IOException <span style="color: #FF0000">{</span>
                order<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setNumber</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">getID</span></span><span style="color: #990000">());</span>
                <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> <span style="color: #990000">(</span><span style="color: #008080">OrderItem</span> orderitem <span style="color: #990000">:</span> order<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getOrderItems</span></span><span style="color: #990000">())</span> <span style="color: #FF0000">{</span>
                        orderitem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setOrderNumber</span></span><span style="color: #990000">(</span>order<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getNumber</span></span><span style="color: #990000">());</span>
                <span style="color: #FF0000">}</span>

                cafe<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">placeOrder</span></span><span style="color: #990000">(</span>order<span style="color: #990000">);</span>
                <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"Successfully created Order #: "</span> <span style="color: #990000">+</span> order<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getNumber</span></span><span style="color: #990000">();</span>
        <span style="color: #FF0000">}</span>
        <span style="color: #990000">...</span>
<span style="color: #FF0000">}</span>
</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;form:form</span></span> <span style="color: #009900">commandName</span><span style="color: #990000">=</span><span style="color: #FF0000">"order"</span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"order"</span> <span style="color: #009900">onsubmit</span><span style="color: #990000">=</span><span style="color: #FF0000">"return false;"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
        ...
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;tr&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;td&gt;&lt;input</span></span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"submit"</span> <span style="color: #009900">value</span><span style="color: #990000">=</span><span style="color: #FF0000">"Submit Order"</span> <span style="color: #009900">onclick</span><span style="color: #990000">=</span><span style="color: #FF0000">"submitOrder()"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;&lt;/td&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;/tr&gt;</span></span>
        ...
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/form:form&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;script</span></span> <span style="color: #009900">type</span><span style="color: #990000">=</span><span style="color: #FF0000">"text/javascript"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
        function submitOrder() {
                jq(function() {
                        jq.post("order", jq('#order').serialize(), function(data) {
                                jq("#success").replaceWith(
                                                '<span style="font-weight: bold"><span style="color: #0000FF">&lt;span</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"success"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>' + data + '<span style="font-weight: bold"><span style="color: #0000FF">&lt;/span&gt;</span></span>');
                                jq("#table").load("/cafe/status");
                        });
                });
        }
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/script&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><div class="title">Processing Module:</div><p>The processing module is responsible for entire use case after the user has placed an order and it operates asynchronously from the web module.
Each stage of the use case is represented as channel in the application. This configured in the application context file:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>
<span style="font-style: italic"><span style="color: #9A1900">&lt;!--The Spring Integration dependencies required are:--&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;dependency&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;groupId&gt;</span></span>org.springframework.integration<span style="font-weight: bold"><span style="color: #0000FF">&lt;/groupId&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;artifactId&gt;</span></span>spring-integration-stream<span style="font-weight: bold"><span style="color: #0000FF">&lt;/artifactId&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;version&gt;</span></span>${spring.integration.version}<span style="font-weight: bold"><span style="color: #0000FF">&lt;/version&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/dependency&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;dependency&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;groupId&gt;</span></span>org.springframework.integration<span style="font-weight: bold"><span style="color: #0000FF">&lt;/groupId&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;artifactId&gt;</span></span>spring-integration-jms<span style="font-weight: bold"><span style="color: #0000FF">&lt;/artifactId&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;version&gt;</span></span>${spring.integration.version}<span style="font-weight: bold"><span style="color: #0000FF">&lt;/version&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/dependency&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;dependency&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;groupId&gt;</span></span>org.springframework.integration<span style="font-weight: bold"><span style="color: #0000FF">&lt;/groupId&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;artifactId&gt;</span></span>spring-integration-jdbc<span style="font-weight: bold"><span style="color: #0000FF">&lt;/artifactId&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;version&gt;</span></span>${spring.integration.version}<span style="font-weight: bold"><span style="color: #0000FF">&lt;/version&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/dependency&gt;</span></span>

<span style="font-style: italic"><span style="color: #9A1900">&lt;!--Channels and namespace configurations--&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;publish-subscribe-channel</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"orders"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;channel</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"drinks"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;channel</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"coldDrinks"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;queue</span></span> <span style="color: #009900">capacity</span><span style="color: #990000">=</span><span style="color: #FF0000">"10"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/channel&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;channel</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"hotDrinks"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;queue</span></span> <span style="color: #009900">capacity</span><span style="color: #990000">=</span><span style="color: #FF0000">"10"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/channel&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;channel</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"coldDrinkBarista"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;channel</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"hotDrinkBarista"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;channel</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"preparedDrinks"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;publish-subscribe-channel</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"deliveries"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>By default &lt;channel&gt; defines a Spring Integration channel that can have a single subscriber, thus &lt;publish-subscribe-channel&gt; is used for the channels that may have multiple subscribers. &lt;queue&gt; creates a QueueChannel which provides message buffering capability. By default it is in-memory but can be configured to use a database if you want to avoid lost messages in case of system failure. In order to transforming/routing/splitting/aggregating orders from channel to channel we use various Spring Integration annotations:</p></div>
<div class="paragraph"><p>To split orders into orderItems we have the OrderSplitter:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>@MessageEndpoint
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">OrderSplitter</span> <span style="color: #FF0000">{</span>

        @<span style="font-weight: bold"><span style="color: #000000">Splitter</span></span><span style="color: #990000">(</span>inputChannel<span style="color: #990000">=</span><span style="color: #FF0000">"orders"</span><span style="color: #990000">,</span> outputChannel<span style="color: #990000">=</span><span style="color: #FF0000">"drinks"</span><span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">List&lt;OrderItem&gt;</span> <span style="font-weight: bold"><span style="color: #000000">split</span></span><span style="color: #990000">(</span><span style="color: #008080">Order</span> order<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> order<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getOrderItems</span></span><span style="color: #990000">();</span>
        <span style="color: #FF0000">}</span>

<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The splitter simply returns the list of individual drinks ordered for each item in the orders channel and then outputs them into the drinks channel.</p></div>
<div class="paragraph"><p>To categorize the drinks as hot or cold, we use a router:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>@MessageEndpoint
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">DrinkRouter</span> <span style="color: #FF0000">{</span>

        @<span style="font-weight: bold"><span style="color: #000000">Router</span></span><span style="color: #990000">(</span>inputChannel<span style="color: #990000">=</span><span style="color: #FF0000">"drinks"</span><span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">String</span> <span style="font-weight: bold"><span style="color: #000000">resolveOrderItemChannel</span></span><span style="color: #990000">(</span><span style="color: #008080">OrderItem</span> orderItem<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #990000">(</span>orderItem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getIced</span></span><span style="color: #990000">())</span> <span style="color: #990000">?</span> <span style="color: #FF0000">"coldDrinks"</span> <span style="color: #990000">:</span> <span style="color: #FF0000">"hotDrinks"</span><span style="color: #990000">;</span>
        <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The router class takes in message payload from the drinks channel and outputs which channel to route the drink to depending on whether it is a hot or cold drink.</p></div>
<div class="paragraph"><p>Because the coldDrinks and hotDrinks queue buffers message, we need to setup to poller to allow a subscriber to connect. To do so, we use a &lt;bridge&gt;, which is configured to poll the buffering channel with a delay and move the messages to subscriber channel:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;bridge</span></span> <span style="color: #009900">input-channel</span><span style="color: #990000">=</span><span style="color: #FF0000">"coldDrinks"</span> <span style="color: #009900">output-channel</span><span style="color: #990000">=</span><span style="color: #FF0000">"coldDrinkBarista"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;poller</span></span> <span style="color: #009900">fixed-delay</span><span style="color: #990000">=</span><span style="color: #FF0000">"1000"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/bridge&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;bridge</span></span> <span style="color: #009900">input-channel</span><span style="color: #990000">=</span><span style="color: #FF0000">"hotDrinks"</span> <span style="color: #009900">output-channel</span><span style="color: #990000">=</span><span style="color: #FF0000">"hotDrinkBarista"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;poller</span></span> <span style="color: #009900">fixed-delay</span><span style="color: #990000">=</span><span style="color: #FF0000">"1000"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/bridge&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>Now as in real life, we have a Barista to prepare drinks:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>@Component
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Barista</span> <span style="color: #FF0000">{</span>
        <span style="color: #990000">...</span>

        @<span style="font-weight: bold"><span style="color: #000000">ServiceActivator</span></span><span style="color: #990000">(</span>inputChannel<span style="color: #990000">=</span><span style="color: #FF0000">"hotDrinkBarista"</span><span style="color: #990000">,</span> outputChannel<span style="color: #990000">=</span><span style="color: #FF0000">"preparedDrinks"</span><span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">Drink</span> <span style="font-weight: bold"><span style="color: #000000">prepareHotDrink</span></span><span style="color: #990000">(</span><span style="color: #008080">OrderItem</span> orderItem<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
                        Thread<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">sleep</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>hotDrinkDelay<span style="color: #990000">);</span>
                        System<span style="color: #990000">.</span>out<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Prepared "</span> <span style="color: #990000">+</span> orderItem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getShots</span></span><span style="color: #990000">()</span> <span style="color: #990000">+</span> <span style="color: #FF0000">" Hot "</span> <span style="color: #990000">+</span> orderItem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getType</span></span><span style="color: #990000">());</span>
                        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Drink</span></span><span style="color: #990000">(</span>orderItem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getOrderNumber</span></span><span style="color: #990000">(),</span> orderItem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getType</span></span><span style="color: #990000">(),</span> orderItem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getIced</span></span><span style="color: #990000">(),</span>
                                        orderItem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getShots</span></span><span style="color: #990000">());</span>
                <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">InterruptedException</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                        Thread<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">currentThread</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">interrupt</span></span><span style="color: #990000">();</span>
                        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">;</span>
                <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>

        @<span style="font-weight: bold"><span style="color: #000000">ServiceActivator</span></span><span style="color: #990000">(</span>inputChannel<span style="color: #990000">=</span><span style="color: #FF0000">"coldDrinkBarista"</span><span style="color: #990000">,</span> outputChannel<span style="color: #990000">=</span><span style="color: #FF0000">"preparedDrinks"</span><span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">Drink</span> <span style="font-weight: bold"><span style="color: #000000">prepareColdDrink</span></span><span style="color: #990000">(</span><span style="color: #008080">OrderItem</span> orderItem<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                <span style="font-weight: bold"><span style="color: #0000FF">try</span></span> <span style="color: #FF0000">{</span>
                        Thread<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">sleep</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #0000FF">this</span></span><span style="color: #990000">.</span>coldDrinkDelay<span style="color: #990000">);</span>
                        System<span style="color: #990000">.</span>out<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Prepared "</span> <span style="color: #990000">+</span> orderItem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getShots</span></span><span style="color: #990000">()</span> <span style="color: #990000">+</span> <span style="color: #FF0000">" Iced "</span> <span style="color: #990000">+</span> orderItem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getType</span></span><span style="color: #990000">());</span>
                        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Drink</span></span><span style="color: #990000">(</span>orderItem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getOrderNumber</span></span><span style="color: #990000">(),</span> orderItem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getType</span></span><span style="color: #990000">(),</span> orderItem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getIced</span></span><span style="color: #990000">(),</span>
                                        orderItem<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getShots</span></span><span style="color: #990000">());</span>
                <span style="color: #FF0000">}</span> <span style="font-weight: bold"><span style="color: #0000FF">catch</span></span> <span style="color: #990000">(</span><span style="color: #008080">InterruptedException</span> e<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
                        Thread<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">currentThread</span></span><span style="color: #990000">().</span><span style="font-weight: bold"><span style="color: #000000">interrupt</span></span><span style="color: #990000">();</span>
                        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">null</span></span><span style="color: #990000">;</span>
                <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span>

<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The Barista subscribes to the coldDrinkBarista and hotDrinkBarista channels and prepares the drinks with appropriate delay and outputs to the prepared drinks channel.</p></div>
<div class="paragraph"><p>Now with all the drinks in the preparedDrinks channel, we need a way to aggregate the drinks back into their orders. This where Spring Integration&#8217;s aggregator, the opposite of splitter, comes in.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>@MessageEndpoint
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">Waiter</span> <span style="color: #FF0000">{</span>

    @<span style="font-weight: bold"><span style="color: #000000">Aggregator</span></span><span style="color: #990000">(</span>inputChannel <span style="color: #990000">=</span> <span style="color: #FF0000">"preparedDrinks"</span><span style="color: #990000">,</span> outputChannel <span style="color: #990000">=</span> <span style="color: #FF0000">"deliveries"</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #008080">Delivery</span> <span style="font-weight: bold"><span style="color: #000000">prepareDelivery</span></span><span style="color: #990000">(</span><span style="color: #008080">List&lt;Drink&gt;</span> drinks<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        System<span style="color: #990000">.</span>out<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">println</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"Delivered "</span> <span style="color: #990000">+</span> drinks<span style="color: #990000">);</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #0000FF">new</span></span> <span style="font-weight: bold"><span style="color: #000000">Delivery</span></span><span style="color: #990000">(</span>drinks<span style="color: #990000">);</span>
    <span style="color: #FF0000">}</span>

    @CorrelationStrategy
    <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">int</span> <span style="font-weight: bold"><span style="color: #000000">correlateByOrderNumber</span></span><span style="color: #990000">(</span><span style="color: #008080">Drink</span> drink<span style="color: #990000">)</span> <span style="color: #FF0000">{</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> drink<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getOrderNumber</span></span><span style="color: #990000">();</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>The aggregator works using a correlation strategy which determines the value to use to put individual objects together.</p></div>
<div class="paragraph"><p>The deliveries channel is filled by the aggregator and can be subscribed to by any endpoint for any further processing/use. For this sample, we showcase the Spring Integration Channel Adapter.</p></div>
<div class="paragraph"><p>We use a outbound-channel-apdater to store the deliveries in a database.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;outbound-channel-adapter</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"outboundDelivery"</span> <span style="color: #009900">ref</span><span style="color: #990000">=</span><span style="color: #FF0000">"JPAOutbound"</span> <span style="color: #009900">method</span><span style="color: #990000">=</span><span style="color: #FF0000">"addDelivery"</span> <span style="color: #009900">channel</span><span style="color: #990000">=</span><span style="color: #FF0000">"deliveries"</span><span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>@<span style="font-weight: bold"><span style="color: #000000">MessageEndpoint</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"JPAOutbound"</span><span style="color: #990000">)</span>
@Transactional
<span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="color: #008080">JPAOutbound</span> <span style="font-weight: bold"><span style="color: #0000FF">implements</span></span> DBOutboundInterface <span style="color: #FF0000">{</span>

        @Autowired
        <span style="font-weight: bold"><span style="color: #0000FF">private</span></span> <span style="color: #008080">DeliveryDao</span> deliveryDao<span style="color: #990000">;</span>

        <span style="font-weight: bold"><span style="color: #0000FF">public</span></span> <span style="color: #009900">void</span> <span style="font-weight: bold"><span style="color: #000000">addDelivery</span></span><span style="color: #990000">(</span><span style="color: #008080">Delivery</span> delivery<span style="color: #990000">)</span><span style="color: #FF0000">{</span>
                deliveryDao<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">saveAndFlush</span></span><span style="color: #990000">(</span>delivery<span style="color: #990000">);</span>
        <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>For this application, we use Spring MVC to display the collected deliveries on the status page: <a href="https://cafe-tmehta.rhcloud.com/cafe-processing/">https://cafe-tmehta.rhcloud.com/cafe-processing/</a></p></div>
<div class="paragraph"><div class="title">Integration between applications:</div><p>With the web module and the processing modules developed all that is left is to do is to connect the two. Here is where Spring Integration really shines.</p></div>
<div class="paragraph"><p>To show how to configure communication between the two application, we will be using JBoss AS 7. JBoss AS 7 out of the box should contain a JMS RemoteConnectionFactory and TestQueue (check the standalone.xml), not add the following lines to $JBOSS_HOME/standalone/configuration/standalone.xml inside &lt;subsystem xmlns="urn:jboss:domain:messaging:1.1"&gt; &lt;hornetq-server&gt;:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;jms-connection-factories&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;connection-factory</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"InVmConnectionFactory"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;connectors&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;connector-ref</span></span> <span style="color: #009900">connector-name</span><span style="color: #990000">=</span><span style="color: #FF0000">"in-vm"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;/connectors&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;entries&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;entry</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"java:/ConnectionFactory"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;/entries&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;/connection-factory&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;connection-factory</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"RemoteConnectionFactory"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;connectors&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;connector-ref</span></span> <span style="color: #009900">connector-name</span><span style="color: #990000">=</span><span style="color: #FF0000">"netty"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;/connectors&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;entries&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;entry</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"RemoteConnectionFactory"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;entry</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"java:jboss/exported/jms/RemoteConnectionFactory"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;/entries&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;/connection-factory&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;pooled-connection-factory</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"hornetq-ra"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;transaction</span></span> <span style="color: #009900">mode</span><span style="color: #990000">=</span><span style="color: #FF0000">"xa"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;connectors&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;connector-ref</span></span> <span style="color: #009900">connector-name</span><span style="color: #990000">=</span><span style="color: #FF0000">"in-vm"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;/connectors&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;entries&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;entry</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"java:/JmsXA"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;/entries&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;/pooled-connection-factory&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/jms-connection-factories&gt;</span></span>


<span style="font-weight: bold"><span style="color: #0000FF">&lt;jms-destinations&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;jms-queue</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"testQueue"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;entry</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"queue/test"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;entry</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"java:jboss/exported/jms/queue/test"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;/jms-queue&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;jms-queue</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"sportsclub"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;entry</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"queue/sportsclub"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;/jms-queue&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;jms-topic</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"testTopic"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;entry</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"topic/test"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;entry</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"java:jboss/exported/jms/topic/test"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;/jms-topic&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/jms-destinations&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>The web module is responsible for outputting orders onto to the testQueue, therefore we configure a outbound jms channel adapter:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;jee:jndi-lookup</span></span> <span style="color: #009900">jndi-name</span><span style="color: #990000">=</span><span style="color: #FF0000">"RemoteConnectionFactory"</span>
        <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"connectionFactory"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/jee:jndi-lookup&gt;</span></span>


<span style="font-weight: bold"><span style="color: #0000FF">&lt;jms:outbound-channel-adapter</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"outputQueue"</span>
        <span style="color: #009900">connection-factory</span><span style="color: #990000">=</span><span style="color: #FF0000">"connectionFactory"</span> <span style="color: #009900">destination-name</span><span style="color: #990000">=</span><span style="color: #FF0000">"testQueue"</span>
        <span style="color: #009900">channel</span><span style="color: #990000">=</span><span style="color: #FF0000">"orders"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/jms:outbound-channel-adapter&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>And for the processing module we have a inbound jms channel adapter that polls the testQueue:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;jee:jndi-lookup</span></span> <span style="color: #009900">jndi-name</span><span style="color: #990000">=</span><span style="color: #FF0000">"RemoteConnectionFactory"</span>
        <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"connectionFactory"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;&lt;/jee:jndi-lookup&gt;</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">&lt;jms:inbound-channel-adapter</span></span> <span style="color: #009900">id</span><span style="color: #990000">=</span><span style="color: #FF0000">"inputQueue"</span>
        <span style="color: #009900">connection-factory</span><span style="color: #990000">=</span><span style="color: #FF0000">"connectionFactory"</span> <span style="color: #009900">destination-name</span><span style="color: #990000">=</span><span style="color: #FF0000">"testQueue"</span>
        <span style="color: #009900">channel</span><span style="color: #990000">=</span><span style="color: #FF0000">"orders"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;poller</span></span> <span style="color: #009900">fixed-delay</span><span style="color: #990000">=</span><span style="color: #FF0000">"1000"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/jms:inbound-channel-adapter&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>So with this you should have application capable to interacting with one another asynchronously. This tutorial provides only the base functionality of Spring Integration, there are wealth of other features that enable you further increase the complexity of your application while maintaining the simplicity of the code. More information about Spring Integration can be found at: <a href="http://static.springsource.org/spring-integration/reference/htmlsingle">http://static.springsource.org/spring-integration/reference/htmlsingle</a>.</p></div>
<div class="paragraph"><div class="title">Summary:</div><p>The source code for this sample can be found at <a href="https://github.com/TejasM/cafe-full">https://github.com/TejasM/cafe-full</a>. And the you can see the application in action at:</p></div>
<div class="paragraph"><p><a href="https://cafe-tmehta.rhcloud.com/cafe-web">https://cafe-tmehta.rhcloud.com/cafe-web</a> - To place orders</p></div>
<div class="paragraph"><p><a href="https://cafe-tmehta.rhcloud.com/cafe-processing">https://cafe-tmehta.rhcloud.com/cafe-processing</a> - To view the processed orders</p></div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2012-11-23 11:47:28 EDT
</div>
</div>
</body>
</html>
